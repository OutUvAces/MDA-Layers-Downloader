#!/usr/bin/env python3

import sys
sys.path.append('.')

from downloaders.navigation_warnings import extract_warning_components

# Test the NAVAREA IV NAV001/26 warning
warning_text = """NAVAREA: IV
Warning: NAV001/26
Category: Operations

Description:
NAVAREA IV MOBILE OFFSHORE DRILLING UNITS
POSITIONS AT 141800Z JAN:
A. AGOSTO 12 19-23.0N 092-03.1W.
B. ALULA 11-38.4N 070-21.8W.
C. ARGOS PLATFORM 27-10.4N 090-22.0W.
D. ATLANTIS 19-23.9N 092-02.3W.
E. BLUE EAGLE 18-28.3N 094-00.7W.
F. BLUE PHOENIX 18-23.1N 093-56.1W.
G. BORR RAN 18-27.3N 093-41.2W.
H. BP ATLANTIS PLATFORM 27-11.7N 090-01.6W.
I. CENTENARIO GR 21-07.7N 097-08.1W.
J. CME I 19-34.6N 092-02.7W.
K. CME II 18-34.4N 092-46.2W.
L. COATZACOALCOS 18-23.0N 093-56.4W.
M. DEEPWATER ASGARD 27-35.8N 092-17.7W.
N. DEEPWATER ATLAS 28-11.1N 089-24.3W.
O. DEEPWATER CONQUEROR 27-09.3N 091-14.0W.
P. DEEPWATER INVICTUS 27-07.3N 090-23.1W.
Q. DEEPWATER PONTUS 26-09.7N 094-47.4W.
R. DEEPWATER POSEIDON 26-11.2N 094-45.8W.
S. DEEPWATER PROTEUS 28-37.0N 087-55.4W.
T. DEEPWATER THALASSA 26-11.1N 094-45.6W.
U. DEEPWATER TITAN 27-09.1N 091-12.7W.
V. DEVELOPMENT DRILLER III 10-38.5N 061-39.0W.
W. ENTERPRISE 264 10-21.2N 061-49.0W.
X. ESSAR WILDCAT 18-51.5N 091-45.7W.
Y. FRIDA I 19-36.1N 092-31.6W.
Z. GALAR 19-34.2N 092-05.5W.
AA. GERSEMI 18-29.3N 093-20.7W.
BB. GRID 19-23.9N 092-17.2W.
CC. GULF DRILLER VI 18-44.9N 093-12.1W.
DD. GULF DRILLER VIII 18-29.8N 094-00.3W.
EE. H&P RIG 201 28-09.6N 089-13.1W.
FF. H&P RIG 203 28-08.5N 089-57.3W.
GG. H&P RIG 205 26-06.8N 094-53.2W.
HH. HELIX Q4000 28-44.8N 088-21.8W.
II. HELIX Q5000 26-12.9N 092-07.9W.
JJ. INDEPENDENCIA I 19-06.6N 092-21.9W.
KK. IOLAIR 19-30.8N 092-09.1W.
LL. JACK ST MALO 26-14.1N 091-15.7W.
MM. JOE DOUGLAS 10-14.0N 060-20.6W.
NN. KUKULKAN 18-16.4N 094-03.6W.
OO. LA COVADONGA 18-31.3N 092-58.2W.
PP. LA SANTA MARIA 18-36.8N 093-17.7W.
QQ. LIZA DESTINY 08-00.7N 056-59.5W.
RR. LIZA UNITY 08-00.6N 056-54.9W.
SS. MAD DOG 27-11.3N 090-16.1W.
TT. MAERSK DEVELOPER 07-11.7N 055-44.0W.
UU. MAERSK DISCOVERER 11-33.1N 073-42.4W.
VV. MARLIN TLP 29-06.5N 087-56.7W.
WW. MIAMTE MV34 18-24.3N 093-46.2W.
XX. NABARIMA 10-14.8N 062-09.0W.
YY. NABORS MODS 140 28-12.5N 088-43.5W.
ZZ. NABORS MODS 200 28-06.2N 090-12.1W.
AAA. NABORS MODS 400 26-56.0N 090-31.4W.
BBB. NFE PIONEER III 22-39.2N 097-40.8W.
CCC. NJORD 18-28.8N 093-27.6W.
DDD. NOBLE BLACKHAWK 29-05.5N 092-03.7W.
EEE. NOBLE BLACKHORNET 27-13.5N 090-01.9W.
FFF. NOBLE BLACKLION 28-27.8N 088-06.3W.
GGG. NOBLE BLACKRHINO 29-02.4N 087-55.4W.
HHH. NOBLE BOB DOUGLAS 07-55.9N 056-43.3W.
III. NOBLE DON TAYLOR 08-00.1N 056-42.7W.
JJJ. NOBLE REGINA ALLEN 10-39.1N 061-37.2W.
KKK. NOBLE SAM CROFT 07-57.8N 056-50.2W.
LLL. NOBLE STANLEY LAFOSSE 28-35.9N 088-20.6W.
MMM. NOBLE TOM MADDEN 07-58.2N 056-51.9W.
NNN. ODIN 19-10.4N 092-25.7W.
OOO. OLYMPUS N88 28-09.6N 089-12.8W.
PPP. ONE GUYANA 07-57.4N 056-43.0W.
QQQ. PAPALOAPAN 19-25.1N 092-03.1W.
RRR. PERRO NEGRO 10 18-20.2N 093-52.2W.
SSS. PIONEER 26-41.7N 090-30.6W.
TTT. PROSPERITY 08-11.7N 057-00.2W.
UUU. RALPH COFFMAN 18-20.4N 093-53.6W.
VVV. SANDUNGA 19-29.1N 091-57.1W.
WWW. SEAROSE FPSO 46-47.2N 048-00.8W.
XXX. SEVAN LOUISIANA 28-07.0N 090-16.9W.
YYY. SHELL WHALE 26-13.4N 094-40.4W.
ZZZ. STENA CARRON 08-55.5N 057-18.4W.
AAAA. STENA EVOLUTION 27-02.6N 092-14.1W.
BBBB. TAHITI SPAR 27-19.6N 090-42.9W.
CCCC. TERRA NOVA 46-28.3N 048-27.9W.
DDDD. THUNDER HORSE PDQ 28-12.8N 088-28.8W.
EEEE. TS TOPAZ 19-02.6N 092-26.6W.
FFFF. TUXPAN 18-45.8N 091-45.7W.
GGGG. UXPANAPA 20-49.3N 096-55.9W.
HHHH. VALARIS DS-16 27-16.4N 090-58.3W.
IIII. VALARIS GORILLA VII 10-13.5N 060-37.0W.
JJJJ. VITO FPU 28-01.5N 089-12.6W.
KKKK. WEST COURAGEOUS 19-30.4N 092-00.0W.
LLLL. WEST DEFENDER 18-28.6N 094-01.9W.
MMMM. WEST INTREPID 19-30.8N 091-58.8W.
NNNN. WEST NEPTUNE 26-11.7N 092-07.9W.
OOOO. WEST VELA 28-27.5N 088-14.9W.
PPPP. WFD 400 28-00.9N 093-57.3W.
QQQQ. WOODPECKER 10-06.8N 060-49.7W.
RRRR. YUNUEN 19-35.3N 092-12.1W.
SSSS. YUUM K'AK' NAAB 19-36.7N 092-17.9W."""

print("Testing NAV001/26 warning splitting...")
prefix, features, suffix = extract_warning_components(warning_text)

print(f"\nPrefix ({len(prefix)} chars):")
print(repr(prefix))

print(f"\nFeatures ({len(features)}):")
for i, feature in enumerate(features[:5]):  # Show first 5
    print(f"  {i+1}: {repr(feature)}")
if len(features) > 5:
    print(f"  ... and {len(features) - 5} more features")

print(f"\nLast feature: {repr(features[-1]) if features else 'None'}")

print(f"\nSuffix ({len(suffix)} chars):")
print(repr(suffix))

# Check expected results
expected_prefix = """NAVAREA: IV
Warning: NAV001/26
Category: Operations

Description:
NAVAREA IV MOBILE OFFSHORE DRILLING UNITS
POSITIONS AT 141800Z JAN:"""

# Should be around 100+ features (A through SSSS)

print("\nValidation:")
print(f"  Prefix correct: {prefix.strip() == expected_prefix.strip()}")
print(f"  Feature count reasonable: {80 <= len(features) <= 120}")  # Allow some flexibility
print(f"  Suffix empty: {len(suffix.strip()) == 0}")

if features:
    # Check first few features
    expected_first = "A. AGOSTO 12 19-23.0N 092-03.1W."
    expected_second = "B. ALULA 11-38.4N 070-21.8W."
    print(f"  First feature correct: {features[0].strip() == expected_first}")
    print(f"  Second feature correct: {features[1].strip() == expected_second}")

    # Check last feature (should end with SSSS)
    if len(features) >= 100:  # Assuming ~100+ features
        last_feature = features[-1]
        print(f"  Last feature ends with SSSS: {'SSSS.' in last_feature}")